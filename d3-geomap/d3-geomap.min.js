// https://d3-geomap.github.io v4.0.0 Copyright 2024 Ramiro GÃ³mez
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("topojson"),require("d3-fetch"),require("d3-geo"),require("d3-array"),require("d3-scale"),require("d3-format")):"function"==typeof define&&define.amd?define(["exports","d3-selection","topojson","d3-fetch","d3-geo","d3-array","d3-scale","d3-format"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).d3=t.d3||{},t.d3,t.topojson,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,(function(t,e,r,n,o,i,a,p){"use strict";function c(t,e,r){return e=f(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,d()?Reflect.construct(e,[],f(t).constructor):e.apply(t,r))}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e,r){return e&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,g(n.key),n)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},u.apply(null,arguments)}function f(t){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},f(t)}function d(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(d=function(){return!!t})()}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function g(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function v(t,e,r){t[e]=function(n){return void 0===n?t.properties[e]||r:(t.properties[e]=n,t)}}var y=function(){return l((function t(){for(var e in s(this,t),this.properties={geofile:null,geoData:null,height:null,postUpdate:null,projection:o.geoNaturalEarth1,rotate:[0,0,0],scale:null,translate:null,unitId:"iso3",unitPrefix:"unit-",units:"units",unitTitle:function(t){return t.properties.name},width:null,zoomFactor:4},this.properties)v(this,e,this.properties[e]);this._={}}),[{key:"clicked",value:function(t){var r=this,n=1,o=r.properties.width/2,i=r.properties.height/2,a=o,p=i;if(t.target){var c=e.select(t.target).datum();if(r._.centered!==c){var s=r.path.centroid(c);a=s[0],p=s[1],n=r.properties.zoomFactor,r._.centered=c}else r._.centered=null;r.svg.selectAll("path.unit").classed("active",(function(t){return t===r._.centered})),r.svg.selectAll("g.zoom").transition().duration(750).attr("transform","translate(".concat(o,", ").concat(i,")scale(").concat(n,")translate(-").concat(a,", -").concat(p,")"))}}},{key:"draw",value:function(t){var e=this;e.data=t.datum(),e.properties.width||(e.properties.width=t.node().getBoundingClientRect().width),e.properties.height||(e.properties.height=e.properties.width/1.92),e.svg=t.append("svg").attr("width",e.properties.width).attr("height",e.properties.height),e.svg.append("rect").attr("class","background").attr("width",e.properties.width).attr("height",e.properties.height).on("click",e.clicked.bind(e));var i=e.properties.projection().precision(.1);e.properties.scale&&i.scale(e.properties.scale),e.properties.translate&&i.scale(e.properties.translate),i.hasOwnProperty("rotate")&&e.properties.rotate&&i.rotate(e.properties.rotate),e.path=o.geoPath().projection(i);Promise.resolve().then((function(){return e.properties.geoData?e.properties.geoData:n.json(e.properties.geofile)})).then((function(t){return function(t){e.geoFeature=r.feature(t,t.objects[e.properties.units]),null===e.properties.scale&&null===e.properties.translate&&i.fitSize([e.properties.width,e.properties.height],e.geoFeature),e.svg.append("g").attr("class","units zoom").selectAll("path").data(e.geoFeature.features).enter().append("path").attr("class",(function(t){return"unit "+e.properties.unitPrefix+e.unitName(t.properties)})).attr("d",e.path).on("click",e.clicked.bind(e)).append("title").text(e.properties.unitTitle),e.update()}(t)}))}},{key:"unitName",value:function(t){var e=t[this.properties.unitId];return void 0!==e?e.toString().trim().replace(/\s/g,"_"):""}},{key:"update",value:function(){this.properties.postUpdate&&this.properties.postUpdate()}}])}(),m=function(t){function e(){var t;s(this,e),t=c(this,e);var r={colors:e.DEFAULT_COLORS,column:null,domain:null,duration:null,format:p.format(",.02f"),legend:!1,valueScale:a.scaleQuantize};for(var n in r)t.properties[n]=r[n],v(t,n,r[n]);return t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(e,t),l(e,[{key:"columnVal",value:function(t){return+t[this.properties.column]}},{key:"defined",value:function(t){return!(isNaN(t)||void 0===t||""===t)}},{key:"update",value:function(){var t,r,n,o=this;o.extent=i.extent(o.data,o.columnVal.bind(o)),o.colorScale=o.properties.valueScale().domain(o.properties.domain||o.extent).range(o.properties.colors),o.svg.selectAll("path.unit").style("fill",null),o.data.forEach((function(t){var e=o.unitName(t),r=t[o.properties.column].toString().trim(),n=o.svg.selectAll(".".concat(o.properties.unitPrefix).concat(e));if(!n.empty()&&o.defined(r)){var i=o.colorScale(r),a=o.properties.unitTitle(n.datum());o.properties.duration?n.transition().duration(o.properties.duration).style("fill",i):n.style("fill",i),r=o.properties.format(r),n.select("title").text("".concat(a,"\n\n").concat(o.properties.column,": ").concat(r))}})),o.properties.legend&&o.drawLegend(o.properties.legend),(t="update",r=this,"function"==typeof(n=u(f(e.prototype),t,r))?function(t){return n.apply(r,t)}:n)([])}},{key:"drawLegend",value:function(){var t,e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this,o=n.properties.colors.length;!0===r?(t=n.properties.width/10,e=n.properties.height/3):(t=r.width,e=r.height);var i=t/7.5,a=e-e/5.4,p=i/2,c=n.properties.height-e,s="translate("+p+","+3*p+")";n.svg.select("g.legend").remove();var l=n.properties.colors.slice().reverse(),u=a/o,f=3/u,d=n.svg.append("g").attr("class","legend").attr("width",t).attr("height",e).attr("transform","translate(0,"+c+")");d.append("rect").style("fill","#fff").attr("class","legend-bg").attr("width",t).attr("height",e),d.append("rect").attr("class","legend-bar").attr("width",i).attr("height",a).attr("transform",s);var h=d.append("g").attr("transform",s);h.selectAll("rect").data(l).enter().append("rect").attr("y",(function(t,e){return e*u})).attr("fill",(function(t,e){return l[e]})).attr("width",i).attr("height",u);var g=n.extent[0],v=n.extent[1],y=!1,m=!1;n.properties.domain&&(n.properties.domain[1]<v&&(m=!0),v=n.properties.domain[1],n.properties.domain[0]>g&&(y=!0),g=n.properties.domain[0]),h.selectAll("text").data(l).enter().append("text").text((function(t,e){if(e===o-1){var r=n.properties.format(g);return y&&(r="< ".concat(r)),r}return n.properties.format(n.colorScale.invertExtent(t)[0])})).attr("class",(function(t,e){return"text-"+e})).attr("x",i+p).attr("y",(function(t,e){return e*u+(u+u*f)})),h.append("text").text((function(){var t=n.properties.format(v);return m&&(t="> ".concat(t)),t})).attr("x",i+p).attr("y",p*f*2)}}])}(y);m.DEFAULT_COLORS=["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],t.choropleth=function(){return new m},t.geomap=function(){return new y}}));
